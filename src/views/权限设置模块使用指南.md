# 权限设置模块使用指南

## 1. 模块概述

权限设置模块是系统的核心安全组件，负责管理用户、角色和权限的分配与验证。本模块采用RBAC (基于角色的访问控制) 模式，结合付费等级管理，实现了细粒度的权限控制和灵活的权限分配机制。

## 2. 核心功能

### 2.1 用户管理
- **用户信息管理**：创建、编辑、删除用户信息，包括用户名、邮箱、手机号、微信号等
- **用户状态管理**：启用/禁用用户账号
- **用户搜索**：根据用户名或邮箱搜索用户

### 2.2 角色管理
- **角色定义**：创建、编辑、删除角色
- **角色权限分配**：为角色分配具体权限
- **权限模板**：提供管理员、普通用户、只读用户等预设权限模板

### 2.3 权限管理
- **权限树管理**：查看、添加、编辑、删除权限节点
- **权限层级**：支持三级权限结构（模块级、功能级、操作级）

### 2.4 付费等级管理
- **等级定义**：创建、编辑、删除付费等级
- **等级权限分配**：为不同付费等级分配相应权限
- **权限模板**：提供免费版、标准版、企业版等预设权限模板

### 2.5 权限变更日志
- **操作记录**：记录所有权限相关操作
- **日志搜索**：根据操作内容、操作人、IP等搜索日志
- **操作类型筛选**：按操作类型（用户、角色、权限、付费等级）筛选日志

### 2.6 自助管理
- **权限查询**：用户查看自己拥有的权限
- **权限申请**：用户提交权限申请

## 3. 权限模型

### 3.1 权限层级结构
```
系统管理
├── 用户管理
│   ├── 查看用户
│   ├── 添加用户
│   ├── 编辑用户
│   ├── 删除用户
│   └── 批量操作
├── 角色管理
│   ├── 查看角色
│   ├── 添加角色
│   ├── 编辑角色
│   ├── 删除角色
│   └── 设置角色权限
├── 权限管理
│   ├── 查看权限
│   ├── 添加权限
│   ├── 编辑权限
│   └── 删除权限
└── 系统设置
    ├── 基本设置
    ├── 安全设置
    └── 通知设置

规标管理
├── 规标数据管理
├── 规范智阅
├── 规范智答
└── 规标导入导出

工程管理
├── 方案智审
├── 风险智控
├── 合同智审
└── 工程数据管理

事故管理
├── 事故案例管理
├── 事故分析
└── 媒体报道

知识库
├── 知识管理
└── 知识检索
```

### 3.2 角色权限映射
- **管理员**：拥有所有权限
- **普通用户**：拥有基础操作权限
- **只读用户**：只能查看数据
- **单模块管理员**：拥有单个模块所有权限
- **多模块管理员**：拥有多个模块所有权限
- **高级用户**：拥有基础操作权限和智能模块操作权限

### 3.3 付费等级权限映射
- **免费版**：仅基础功能权限
- **标准版**：标准功能权限
- **企业版**：全功能权限

## 4. 使用指南

### 4.1 用户管理
1. **添加用户**：点击"添加用户"按钮，填写用户信息并选择角色
2. **编辑用户**：点击用户列表中的"编辑"按钮，修改用户信息
3. **删除用户**：点击用户列表中的"删除"按钮，确认后删除用户
4. **切换用户状态**：点击用户列表中的"启用/禁用"按钮，切换用户状态
5. **搜索用户**：在搜索框中输入用户名或邮箱，点击"搜索"按钮

### 4.2 角色管理
1. **添加角色**：点击"添加角色"按钮，填写角色名称和描述
2. **编辑角色**：点击角色列表中的"编辑"按钮，修改角色信息
3. **删除角色**：点击角色列表中的"删除"按钮，确认后删除角色
4. **设置角色权限**：点击角色列表中的"权限设置"按钮，在弹出的对话框中选择权限

### 4.3 权限管理
1. **添加权限**：点击"添加权限"按钮，填写权限ID、名称和父权限
2. **编辑权限**：点击权限树中的"编辑"按钮，修改权限信息
3. **删除权限**：点击权限树中的"删除"按钮，确认后删除权限

### 4.4 付费等级管理
1. **添加付费等级**：点击"添加付费等级"按钮，填写等级名称、描述和价格
2. **编辑付费等级**：点击等级列表中的"编辑"按钮，修改等级信息
3. **删除付费等级**：点击等级列表中的"删除"按钮，确认后删除等级
4. **设置等级权限**：点击等级列表中的"权限设置"按钮，在弹出的对话框中选择权限

### 4.5 权限变更日志
1. **搜索日志**：在搜索框中输入操作内容、操作人或IP，点击"搜索"按钮
2. **筛选日志**：在操作类型下拉框中选择操作类型，点击"搜索"按钮
3. **清空筛选**：点击"清空筛选"按钮，重置所有筛选条件

### 4.6 自助管理
1. **查看权限**：在"自助管理"标签页中查看自己拥有的权限
2. **申请权限**：在"权限申请"区域选择要申请的权限，填写申请理由，点击"提交申请"按钮

## 5. 权限验证机制

### 5.1 前端验证
- **菜单权限控制**：根据用户权限显示/隐藏菜单项
- **按钮权限控制**：根据用户权限显示/隐藏操作按钮
- **页面权限控制**：根据用户权限控制页面访问权限

### 5.2 后端验证
- **API权限验证**：在API请求中验证用户权限
- **数据权限验证**：验证用户对特定数据的访问权限
- **权限缓存**：使用缓存提高权限验证性能

## 6. 安全最佳实践

### 6.1 权限管理
- **最小权限原则**：只授予用户完成任务所需的最小权限
- **权限定期审查**：定期审查用户权限，及时回收不必要的权限
- **权限变更审批**：重要权限变更需要审批流程

### 6.2 操作安全
- **操作日志**：记录所有权限相关操作，便于审计
- **IP限制**：根据需要限制特定IP的访问权限
- **会话管理**：合理设置会话超时时间

## 7. 故障排查

### 7.1 常见问题
1. **用户无法登录**：检查用户状态是否为"活跃"，检查密码是否正确
2. **用户无权限访问某功能**：检查用户所属角色是否拥有该功能的权限
3. **权限设置不生效**：检查权限设置是否保存成功，检查用户缓存是否刷新

### 7.2 排查步骤
1. **检查用户信息**：确认用户状态和所属角色
2. **检查角色权限**：确认角色拥有的权限
3. **检查权限树**：确认权限节点是否存在
4. **检查日志**：查看相关操作日志，了解权限变更历史

## 8. 性能优化

### 8.1 权限验证优化
- **缓存策略**：使用缓存存储用户权限信息，减少数据库查询
- **批量验证**：批量验证用户权限，减少多次请求

### 8.2 界面响应优化
- **懒加载**：权限树采用懒加载方式，提高页面加载速度
- **分页处理**：用户列表、日志列表等采用分页处理，减少数据传输

## 9. 版本更新记录

| 版本号 | 更新内容 | 更新时间 |
|--------|---------|----------|
| V0.42  | 完善权限设置模块，增加付费等级管理子模块 | 2024-01-20 |
| V0.43  | 重构权限模型，优化权限分配流程 | 2024-01-21 |
| V0.44  | 添加权限变更日志记录功能 | 2024-01-22 |
| V0.45  | 实现用户权限自助管理界面 | 2024-01-23 |

## 10. 联系支持

如果您在使用权限设置模块时遇到任何问题，请联系系统管理员或技术支持团队。

- 技术支持邮箱：support@example.com
- 技术支持电话：400-123-4567
- 在线支持：系统右上角"帮助"按钮
